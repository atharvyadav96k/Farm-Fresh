<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Form</title>
</head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">


<body>
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-success-subtle">
            <div class="container-fluid">
                <a class="navbar-brand" href="/" >
                    <img src="/images/logo-color.svg" alt="Logo" width="50" height="54"
                        class="d-inline-block align-text-top">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/search">Search</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <div>
            <form id="box" action="/product" method="post">
                <div class="mb-3 p-2 bg-success mt-1" style="margin: auto;display: flex;width: 80px; aspect-ratio: 1; justify-content: center;align-items: center; border-radius: 50%;">
                    <label for="fileInput" class="text-primary">
                        <svg 
                            xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="currentColor"
                            class="bi bi-arrow-bar-up" viewBox="0 0 16 16"
                            style="cursor: pointer; border-radius: 50%; color: white;">
                            <path fill-rule="evenodd"
                                d="M8 10a.5.5 0 0 0 .5-.5V3.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 3.707V9.5a.5.5 0 0 0 .5.5m-7 2.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 0 1h-13a.5.5 0 0 1-.5-.5" />
                        </svg>
                    </label>
                    <input type="file" id="fileInput" accept="image/*" style="display: none;" required />
                    <input type="text" name="url" id="url" style="display: none;" required>
                    <input type="text" id="location" name="location" style="display: none;">
                </div>
                <div class="progress" role="progressbar" aria-label="Success striped example" aria-valuenow="25"
                    aria-valuemin="0" aria-valuemax="100">
                    <div id="uploadProgress" class="progress-bar progress-bar-striped bg-success" style="width: 0%">
                    </div>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Product Name</label>
                    <input type="text" class="form-control" id="productName" name="productName"
                        aria-describedby="emailHelp" required>
                </div>
                <div class="form-floating">
                    <textarea class="form-control" placeholder="Leave a comment here" id="productDescription"
                        name="productDescription" style="height: 100px"></textarea>
                    <label for="floatingTextarea2">Description</label>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Keys</label>
                    <input type="text" class="form-control" id="productKeys" name="productKeys"
                        aria-describedby="emailHelp" required>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Items</label>
                    <input type="number" class="form-control" id="numItems" name="numItems"
                        aria-describedby="emailHelp" required>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Price</label>
                    <input type="number" class="form-control" id="price" name="price"
                        aria-describedby="emailHelp" required>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Address</label>
                    <input type="text" class="form-control" id="address" name="address" aria-describedby="emailHelp" required>
                </div>
                <div class="mb-3">
                    <label for="exampleInputEmail1" class="form-label">Select Category</label>
                    <select class="form-select form-select-lg mb-3" aria-label="Large select example">
                        <option value="Vegetables">Vegetables</option>
                        <option value="Fruits">Fruits</option>
                        <option value="Dairy Products">Dairy Products</option>
                        <option value="Grains">Grains</option>
                        <option value="Nuts & Seeds">Nuts & Seeds</option>
                        <option value="Live stocks">Live stocks</option>
                        <option value="Flowers & Plants">Flowers & Plants</option>
                        <option value="Special Products">Special Products</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary mb-2" id="submitform" style="width: 100%;">Submit</button>
            </form>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCs-YFdHBycSSV-gybcxWq73a8X_ziRg34",
            authDomain: "fir-1029c.firebaseapp.com",
            projectId: "fir-1029c",
            storageBucket: "fir-1029c.appspot.com",
            messagingSenderId: "739870456643",
            appId: "1:739870456643:web:93b60ed42ae4e419334df6"
        };
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
        const fileInput = document.getElementById('fileInput');
        const uploadProgressElement = document.getElementById('uploadProgress');
        // const uploadPercentageElement = document.getElementById('uploadPercentage');

        fileInput.addEventListener('change', function () {
            uploadImage();
        });

        function uploadImage() {
            const file = fileInput.files[0];

            if (file) {
                // Create a unique filename using a timestamp
                const timestamp = new Date().getTime();
                const filename = `${timestamp}_${file.name}`;

                // Create a reference to the storage bucket and the filename
                const storageRef = storage.ref('images/' + filename);

                // Upload file to Firebase Storage
                const uploadTask = storageRef.put(file);

                // Listen for state changes, errors, and completion of the upload.
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Get upload progress as a percentage
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        uploadProgressElement.value = progress;
                        document.getElementById('uploadProgress').style.width = `${progress.toFixed(2)}%`
                        // uploadPercentageElement.textContent = `${progress.toFixed(2)}%`;
                    },
                    (error) => {
                        console.error('Error uploading file:', error);
                    },
                    () => {
                        // Upload completed successfully, get the download URL
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            // Display the image URL
                            console.log('Image URL:', downloadURL);
                            document.getElementById('url').value = downloadURL;
                        });
                    }
                );
            } else {
                console.error('No file selected!');
            }
        }

    </script>
    <script src="/javascripts/product.js"></script>
</body>

</html>